/**
@overview	##Info
@version	1.3.0
@license	Dual licensed under MIT license and GPL.
@author		Jan Paepke - e-mail@janpaepke.de

@todo: enhancement: remove dependencies and move to plugins -> 2.0
@todo: bug: when cascading pins (pinning one element multiple times) and later removing them without reset, positioning errors occur.
@todo: bug: having multiple scroll directions with cascaded pins doesn't work (one scroll vertical, one horizontal)
@todo: feature: optimize performance on debug plugin (huge drawbacks, when using many scenes)
*/
!function(e,t){if("function"==typeof define&&define.amd)define(["jquery","TweenMax","TimelineMax"],t);else{var n=t(e.jQuery,e.TweenMax,e.TimelineMax);e.ScrollMagic=n.Controller,e.ScrollScene=n.Scene}}(this,function($,e,t){var n=function(e){var t="ScrollMagic",n={container:window,vertical:!0,globalSceneOptions:{},loglevel:2,refreshInterval:100},s=this,u=$.extend({},n,e),g=[],f=!1,d=0,h="PAUSED",p=!0,v=0,w=!0,m,R,S=function(){if(s.version=s.constructor.version,$.each(u,function(e,t){n.hasOwnProperty(e)||(O(2,'WARNING: Unknown option "'+e+'"'),delete u[e])}),u.container=$(u.container).first(),0===u.container.length)throw O(1,"ERROR creating object ScrollMagic: No valid scroll container supplied"),t+" init failed.";p=!$.contains(document,u.container.get(0)),p||u.container.on("resize",function(e){e.stopPropagation()}),v=u.vertical?u.container.height():u.container.width(),u.container.on("scroll resize",T),u.refreshInterval=parseInt(u.refreshInterval),u.refreshInterval>0&&(R=window.setInterval(F,u.refreshInterval)),m=a(b),O(3,"added new ScrollMagic controller (v"+s.version+")")},E=function(){return u.vertical?u.container.scrollTop():u.container.scrollLeft()},y=function(e){u.vertical?u.container.scrollTop(e):u.container.scrollLeft(e)},b=function(){if(m=a(b),w&&f){var e=$.isArray(f)?f:g.slice(0),t=d;d=s.scrollPos();var n=d-t;h=0===n?"PAUSED":n>0?"FORWARD":"REVERSE",n<0&&e.reverse(),$.each(e,function(t,n){O(3,"updating Scene "+(t+1)+"/"+e.length+" ("+g.length+" total)"),n.update(!0)}),0===e.length&&u.loglevel>=3&&O(3,"updating 0 Scenes (nothing added to controller)"),f=!1}},T=function(e){"resize"==e.type&&(v=u.vertical?u.container.height():u.container.width()),f=!0},F=function(){p||v!=(u.vertical?u.container.height():u.container.width())&&u.container.trigger("resize"),$.each(g,function(e,t){t.refresh()})},O=function(e,t){if(u.loglevel>=e){var n=Array.prototype.splice.call(arguments,1);n.unshift(e,"(ScrollMagic) ->"),i.apply(window,n)}},I=function(e){if(e.length<=1)return e;var t=e.slice(0);return t.sort(function(e,t){return e.scrollOffset()>t.scrollOffset()?1:-1}),t};return this.addScene=function(e){return $.isArray(e)?$.each(e,function(e,t){s.addScene(t)}):e instanceof r?e.parent()!=s?e.addTo(s):$.inArray(e,g)<0&&(g.push(e),g=I(g),e.on("shift.ScrollMagic_sort",function(){g=I(g)}),$.each(u.globalSceneOptions,function(t,n){e[t]&&e[t].call(e,n)}),O(3,"added Scene ("+g.length+" total)")):O(1,"ERROR: invalid argument supplied for '.addScene()'"),s},this.removeScene=function(e){if($.isArray(e))$.each(e,function(e,t){s.removeScene(t)});else{var t=$.inArray(e,g);t>-1&&(e.off("shift.ScrollMagic_sort"),g.splice(t,1),e.remove(),O(3,"removed Scene ("+g.length+" total)"))}return s},this.updateScene=function(e,t){return $.isArray(e)?$.each(e,function(e,n){s.updateScene(n,t)}):t?e.update(!0):($.isArray(f)||(f=[]),-1==$.inArray(e,f)&&f.push(e),f=I(f)),s},this.update=function(e){return T({type:"resize"}),e&&b(),s},this.scrollTo=function(e){if(e instanceof r)e.parent()===s?s.scrollTo(e.scrollOffset()):O(2,"scrollTo(): The supplied scene does not belong to this controller. Scroll cancelled.",e);else if("string"===$.type(e)||l(e)||e instanceof $){var t=$(e).first();if(t[0]){var n=u.vertical?"top":"left",i=o(u.container),a=o(t);p||(i[n]-=s.scrollPos()),s.scrollTo(a[n]-i[n])}else O(2,"scrollTo(): The supplied element could not be found. Scroll cancelled.",e)}else $.isFunction(e)?y=e:y.call(u.container[0],e);return s},this.scrollPos=function(e){return arguments.length?($.isFunction(e)?E=e:O(2,"Provided value for method 'scrollPos' is not a function. To change the current scroll position use 'scrollTo()'."),s):E.call(s)},this.info=function(e){var t={size:v,vertical:u.vertical,scrollPos:d,scrollDirection:h,container:u.container,isDocument:p};return arguments.length?void 0!==t[e]?t[e]:void O(1,'ERROR: option "'+e+'" is not available'):t},this.loglevel=function(e){return arguments.length?(u.loglevel!=e&&(u.loglevel=e),s):u.loglevel},this.enabled=function(e){return arguments.length?(w!=e&&(w=!!e,s.updateScene(g,!0)),s):w},this.destroy=function(e){window.clearTimeout(R);for(var t=g.length;t--;)g[t].destroy(e);return u.container.off("scroll resize",T),c(m),O(3,"destroyed ScrollMagic (reset: "+(e?"true":"false")+")"),null},S(),s};n.version="1.3.0";var r=function(e){var r={onCenter:.5,onEnter:1,onLeave:0},l="ScrollScene",a={duration:0,offset:0,triggerElement:null,triggerHook:"onCenter",reverse:!0,tweenChanges:!1,loglevel:2},c=this,u=$.extend({},a,e),g="BEFORE",f=0,d={start:0,end:0},h=0,p=!0,v,w,m,R,S,E,y,b={unknownOptionSupplied:function(){$.each(u,function(e,t){a.hasOwnProperty(e)||(F(2,'WARNING: Unknown option "'+e+'"'),delete u[e])})},duration:function(){if($.isFunction(u.duration)){v=u.duration;try{u.duration=parseFloat(v())}catch(e){F(1,'ERROR: Invalid return value of supplied function for option "duration":',u.duration),v=void 0,u.duration=a.duration}}else u.duration=parseFloat(u.duration),(!$.isNumeric(u.duration)||u.duration<0)&&(F(1,'ERROR: Invalid value for option "duration":',u.duration),u.duration=a.duration)},offset:function(){u.offset=parseFloat(u.offset),$.isNumeric(u.offset)||(F(1,'ERROR: Invalid value for option "offset":',u.offset),u.offset=a.offset)},triggerElement:function(){null!==u.triggerElement&&0===$(u.triggerElement).length&&(F(1,'ERROR: Element defined in option "triggerElement" was not found:',u.triggerElement),u.triggerElement=a.triggerElement)},triggerHook:function(){u.triggerHook in r||($.isNumeric(u.triggerHook)?u.triggerHook=Math.max(0,Math.min(parseFloat(u.triggerHook),1)):(F(1,'ERROR: Invalid value for option "triggerHook": ',u.triggerHook),u.triggerHook=a.triggerHook))},reverse:function(){u.reverse=!!u.reverse},tweenChanges:function(){u.tweenChanges=!!u.tweenChanges},loglevel:function(){if(u.loglevel=parseInt(u.loglevel),!$.isNumeric(u.loglevel)||u.loglevel<0||u.loglevel>3){var e=u.loglevel;u.loglevel=a.loglevel,F(1,'ERROR: Invalid value for option "loglevel":',e)}}},T=function(){O(),c.on("change.internal",function(e){"loglevel"!==e.what&&"tweenChanges"!==e.what&&("triggerElement"===e.what?N():"reverse"===e.what&&c.update())}).on("shift.internal",function(e){z(),c.update(),("AFTER"===g&&"duration"===e.reason||"DURING"===g&&0===u.duration)&&A()}).on("progress.internal",function(e){D(),A()}).on("destroy",function(e){e.preventDefault()})},F=function(e,t){if(u.loglevel>=e){var n=Array.prototype.splice.call(arguments,1);n.unshift(e,"(ScrollScene) ->"),i.apply(window,n)}},O=function(e){if(arguments.length)$.isArray(e)||(e=[e]);else{e=[];for(var t in b)e.push(t)}$.each(e,function(e,t){b[t]&&b[t]()})},I=function(e,t){var n=!1,r=u[e];return u[e]!=t&&(u[e]=t,O(e),n=r!=u[e]),n},z=function(){d={start:h+u.offset},w&&u.triggerElement&&(d.start-=w.info("size")*c.triggerHook()),d.end=d.start+u.duration},C=function(e){if(v){var t="duration";I(t,v.call(c))&&!e&&(c.trigger("change",{what:t,newval:u[t]}),c.trigger("shift",{reason:t}))}},N=function(e){var t=0;if(w&&u.triggerElement){for(var n=$(u.triggerElement).first(),r=w.info(),i=o(r.container),l=r.vertical?"top":"left";n.parent().data("ScrollMagicPinSpacer");)n=n.parent();var s=o(n);r.isDocument||(i[l]-=w.scrollPos()),t=s[l]-i[l]}var a=t!=h;h=t,a&&!e&&c.trigger("shift",{reason:"triggerElementPosition"})},D=function(e){if(m){var t=e>=0&&e<=1?e:f;if(-1===m.repeat())if("DURING"===g&&m.paused())m.play();else{if("DURING"===g||m.paused())return!1;m.pause()}else{if(t==m.progress())return!1;0===u.duration?"DURING"===g?m.play():m.reverse():u.tweenChanges?m.tweenTo(t*m.duration()):m.progress(t).pause()}return!0}return!1},A=function(e){if(R&&w){var t=w.info();if(e||"DURING"!==g){var n={position:S.inFlow?"relative":"absolute",top:0,left:0},r=R.css("position")!=n.position;S.pushFollowers?u.duration>0&&("AFTER"===g&&0===parseFloat(S.spacer.css("padding-top"))?r=!0:"BEFORE"===g&&0===parseFloat(S.spacer.css("padding-bottom"))&&(r=!0)):n[t.vertical?"top":"left"]=u.duration*f,R.css(n),r&&(R.removeClass(S.pinnedClass),P())}else{"fixed"!=R.css("position")&&(R.css("position","fixed"),P(),R.addClass(S.pinnedClass));var i=o(S.spacer,!0),l=u.reverse||0===u.duration?t.scrollPos-d.start:Math.round(f*u.duration*10)/10;i.top-=parseFloat(S.spacer.css("margin-top")),i[t.vertical?"top":"left"]+=l,R.css({top:i.top,left:i.left})}}},P=function(){if(R&&w&&S.inFlow){var e="AFTER"===g,t="BEFORE"===g,n="DURING"===g,r="fixed"==R.css("position"),i=w.info("vertical"),o=S.spacer.children().first(),l=s(S.spacer.css("display")),a={};l?(a["margin-top"]=t||n&&r?R.css("margin-top"):"auto",a["margin-bottom"]=e||n&&r?R.css("margin-bottom"):"auto"):a["margin-top"]=a["margin-bottom"]="auto",S.relSize.width||S.relSize.autoFullWidth?r?$(window).width()==S.spacer.parent().width()?R.css("width",S.relSize.autoFullWidth?"100%":"inherit"):R.css("width",S.spacer.width()):R.css("width","100%"):(a["min-width"]=o.outerWidth(!o.is(R)),a.width=r?a["min-width"]:"auto"),S.relSize.height?r?$(window).height()==S.spacer.parent().height()?R.css("height","inherit"):R.css("height",S.spacer.height()):R.css("height","100%"):(a["min-height"]=o.outerHeight(!l),a.height=r?a["min-height"]:"auto"),S.pushFollowers&&(a["padding"+(i?"Top":"Left")]=u.duration*f,a["padding"+(i?"Bottom":"Right")]=u.duration*(1-f)),S.spacer.css(a)}},x=function(){w&&R&&"DURING"===g&&!w.info("isDocument")&&A()},M=function(){w&&R&&"DURING"===g&&((S.relSize.width||S.relSize.autoFullWidth)&&$(window).width()!=S.spacer.parent().width()||S.relSize.height&&$(window).height()!=S.spacer.parent().height())&&P()},k=function(e){w&&R&&"DURING"===g&&!w.info("isDocument")&&(e.preventDefault(),w.scrollTo(w.info("scrollPos")-(e.originalEvent.wheelDelta/3||30*-e.originalEvent.detail)))};return this.parent=function(){return w},this.duration=function(e){var t="duration";return arguments.length?($.isFunction(e)||(v=void 0),I(t,e)&&(c.trigger("change",{what:t,newval:u[t]}),c.trigger("shift",{reason:t})),c):u[t]},this.offset=function(e){var t="offset";return arguments.length?(I(t,e)&&(c.trigger("change",{what:t,newval:u[t]}),c.trigger("shift",{reason:t})),c):u[t]},this.triggerElement=function(e){var t="triggerElement";return arguments.length?(I(t,e)&&c.trigger("change",{what:t,newval:u[t]}),c):u[t]},this.triggerHook=function(e){var t="triggerHook";return arguments.length?(I(t,e)&&(c.trigger("change",{what:t,newval:u[t]}),c.trigger("shift",{reason:t})),c):$.isNumeric(u[t])?u[t]:r[u[t]]},this.reverse=function(e){var t="reverse";return arguments.length?(I(t,e)&&c.trigger("change",{what:t,newval:u[t]}),c):u[t]},this.tweenChanges=function(e){var t="tweenChanges";return arguments.length?(I(t,e)&&c.trigger("change",{what:t,newval:u[t]}),c):u[t]},this.loglevel=function(e){var t="loglevel";return arguments.length?(I(t,e)&&c.trigger("change",{what:t,newval:u[t]}),c):u[t]},this.state=function(){return g},this.triggerPosition=function(){var e=u.offset;return w&&(u.triggerElement?e+=h:e+=w.info("size")*c.triggerHook()),e},this.triggerOffset=function(){return c.triggerPosition()},this.scrollOffset=function(){return d.start},this.update=function(e){if(w)if(e)if(w.enabled()&&p){var t=w.info("scrollPos"),n;n=u.duration>0?(t-d.start)/(d.end-d.start):t>=d.start?1:0,c.trigger("update",{startPos:d.start,endPos:d.end,scrollPos:t}),c.progress(n)}else R&&"DURING"===g&&A(!0);else w.updateScene(c,!1);return c},this.refresh=function(){return C(),N(),c},this.progress=function(e){if(arguments.length){var t=!1,n=g,r=w?w.info("scrollDirection"):"PAUSED",i=u.reverse||e>=f;if(0===u.duration?(t=f!=e,f=e<1&&i?0:1,g=0===f?"BEFORE":"DURING"):e<=0&&"BEFORE"!==g&&i?(f=0,g="BEFORE",t=!0):e>0&&e<1&&i?(f=e,g="DURING",t=!0):e>=1&&"AFTER"!==g?(f=1,g="AFTER",t=!0):"DURING"!==g||i||A(),t){var o={progress:f,state:g,scrollDirection:r},l=g!=n,s=function(e){c.trigger(e,o)};l&&"DURING"!==n&&(s("enter"),s("BEFORE"===n?"start":"end")),s("progress"),l&&"DURING"!==g&&(s("BEFORE"===g?"start":"end"),s("leave"))}return c}return f},this.setTween=function(e){if(!t)return F(1,"ERROR: TimelineMax wasn't found. Please make sure GSAP is loaded before ScrollMagic or use asynchronous loading."),c;m&&c.removeTween();try{m=new t({smoothChildTiming:!0}).add(e).pause()}catch(e){F(1,"ERROR calling method 'setTween()': Supplied argument is not a valid TweenObject")}finally{e.repeat&&-1===e.repeat()&&(m.repeat(-1),m.yoyo(e.yoyo()))}if(m&&w&&u.triggerElement&&u.loglevel>=2){var n=m.getTweensOf($(u.triggerElement)),r=w.info("vertical");$.each(n,function(e,t){var n=t.vars.css||t.vars;if(r?void 0!==n.top||void 0!==n.bottom:void 0!==n.left||void 0!==n.right)return F(2,"WARNING: Tweening the position of the trigger element affects the scene timing and should be avoided!"),!1})}if(parseFloat(TweenLite.version)>=1.14)for(var i=m.getChildren(!0,!0,!1),o=function(){F(2,"WARNING: tween was overwritten by another. To learn how to avoid this issue see here: https://github.com/janpaepke/ScrollMagic/wiki/WARNING:-tween-was-overwritten-by-another")},l=0,s,a;l<i.length;l++)s=i[l],a!==o&&(a=s.vars.onOverwrite,s.vars.onOverwrite=function(){a&&a.apply(this,arguments),o.apply(this,arguments)});return F(3,"added tween"),D(),c},this.removeTween=function(e){return m&&(e&&D(0),m.kill(),m=void 0,F(3,"removed tween (reset: "+(e?"true":"false")+")")),c},this.setPin=function(e,t){var n={pushFollowers:!0,spacerClass:"scrollmagic-pin-spacer",pinnedClass:""};if(t=$.extend({},n,t),e=$(e).first(),0===e.length)return F(1,"ERROR calling method 'setPin()': Invalid pin element supplied."),c;if("fixed"==e.css("position"))return F(1,"ERROR calling method 'setPin()': Pin does not work with elements that are positioned 'fixed'."),c;if(R){if(R===e)return c;c.removePin()}R=e,R.parent().hide();var r="absolute"!=R.css("position"),i=R.css(["display","top","left","bottom","right"]),o=R.css(["width","height"]);R.parent().show(),"0px"===o.width&&r&&s(i.display),!r&&t.pushFollowers&&(F(2,"WARNING: If the pinned element is positioned absolutely pushFollowers is disabled."),t.pushFollowers=!1);var l=$("<div></div>").addClass(t.spacerClass).css(i).data("ScrollMagicPinSpacer",!0).css({position:r?"relative":"absolute","margin-left":"auto","margin-right":"auto","box-sizing":"content-box"}),a=R[0].style;return S={spacer:l,relSize:{width:"%"===o.width.slice(-1),height:"%"===o.height.slice(-1),autoFullWidth:"0px"===o.width&&r&&s(i.display)},pushFollowers:t.pushFollowers,inFlow:r,origStyle:{width:a.width||"",position:a.position||"",top:a.top||"",left:a.left||"",bottom:a.bottom||"",right:a.right||"","box-sizing":a["box-sizing"]||"","-moz-box-sizing":a["-moz-box-sizing"]||"","-webkit-box-sizing":a["-webkit-box-sizing"]||""},pinnedClass:t.pinnedClass},S.relSize.width&&l.css("width",o.width),S.relSize.height&&l.css("height",o.height),R.before(l).appendTo(l).css({position:r?"relative":"absolute",top:"auto",left:"auto",bottom:"auto",right:"auto"}),(S.relSize.width||S.relSize.autoFullWidth)&&R.css("box-sizing","border-box"),$(window).on("scroll.ScrollScene_pin resize.ScrollScene_pin",x),R.on("mousewheel DOMMouseScroll",k),F(3,"added pin"),A(),c},this.removePin=function(e){return R&&(e||!w?(R.insertBefore(S.spacer).css(S.origStyle),S.spacer.remove()):"DURING"===g&&A(!0),$(window).off("scroll.ScrollScene_pin resize.ScrollScene_pin"),R.off("mousewheel DOMMouseScroll",k),R=void 0,F(3,"removed pin (reset: "+(e?"true":"false")+")")),c},this.setClassToggle=function(e,t){var n=$(e);return 0===n.length||"string"!==$.type(t)?(F(1,"ERROR calling method 'setClassToggle()': Invalid "+(0===n.length?"element":"classes")+" supplied."),c):(E=t,y=n,c.on("enter.internal_class leave.internal_class",function(e){y.toggleClass(E,"enter"===e.type)}),c)},this.removeClassToggle=function(e){return y&&e&&y.removeClass(E),c.off("start.internal_class end.internal_class"),E=void 0,y=void 0,c},this.addTo=function(e){return e instanceof n?w!=e&&(w&&w.removeScene(c),w=e,O(),C(!0),N(!0),z(),P(),w.info("container").on("resize."+l,function(){M(),c.triggerHook()>0&&c.trigger("shift",{reason:"containerSize"})}),F(3,"added ScrollScene to controller"),e.addScene(c),c.update()):F(1,"ERROR: supplied argument of 'addTo()' is not a valid ScrollMagic controller"),c},this.enabled=function(e){return arguments.length?(p!=e&&(p=!!e,c.update(!0)),c):p},this.remove=function(){if(w){w.info("container").off("resize."+l);var e=w;w=void 0,F(3,"removed ScrollScene from controller"),e.removeScene(c)}return c},this.destroy=function(e){return c.removeTween(e),c.removePin(e),c.removeClassToggle(e),c.trigger("destroy",{reset:e}),c.remove(),c.off("start end enter leave progress change update shift destroy shift.internal change.internal progress.internal"),F(3,"destroyed ScrollScene (reset: "+(e?"true":"false")+")"),null},this.on=function(e,t){if($.isFunction(t)){var n=$.trim(e).toLowerCase().replace(/(\w+)\.(\w+)/g,"$1.ScrollScene_$2").replace(/( |^)(\w+)(?= |$)/g,"$1$2."+l);$(c).on(n,t)}else F(1,"ERROR calling method 'on()': Supplied argument is not a valid callback!");return c},this.off=function(e,t){var n=$.trim(e).toLowerCase().replace(/(\w+)\.(\w+)/g,"$1.ScrollScene_$2").replace(/( |^)(\w+)(?= |$)/g,"$1$2.ScrollScene$3");return $(c).off(n,t),c},this.trigger=function(e,t){F(3,"event fired:",e,"->",t);var n=$.Event($.trim(e).toLowerCase(),t);return $(c).trigger(n),c},T(),c},i=function(e){var t=["error","warn","log"];e.log||(e.log=function(){});for(var n=0,r;n<t.length;n++)r=t[n],e[r]||(e[r]=e.log);return function(n){(n>t.length||n<=0)&&(n=t.length);var r=new Date,i=("0"+r.getHours()).slice(-2)+":"+("0"+r.getMinutes()).slice(-2)+":"+("0"+r.getSeconds()).slice(-2)+":"+("00"+r.getMilliseconds()).slice(-3),o=t[n-1],l=Array.prototype.splice.call(arguments,1),s=Function.prototype.bind.call(e[o],e);l.unshift(i),s.apply(e,l)}}(window.console=window.console||{}),o=function(e,t){var n={top:0,left:0};if((e=e[0])&&e.getBoundingClientRect){var r=e.getBoundingClientRect();n.top=r.top,n.left=r.left,t||(n.top+=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||0),n.left+=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0))}return n},l=function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},s=function(e){return["block","flex","list-item","table","-webkit-box"].indexOf(e)>-1},a=window.requestAnimationFrame,c=window.cancelAnimationFrame;return function(e){var t=0,n=["ms","moz","webkit","o"],r;for(r=0;!a&&r<n.length;++r)a=e[n[r]+"RequestAnimationFrame"],c=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];a||(a=function(n){var r=(new Date).getTime(),i=Math.max(0,16-(r-t)),o=e.setTimeout(function(){n(r+i)},i);return t=r+i,o}),c||(c=function(t){e.clearTimeout(t)})}(window),{Controller:n,Scene:r}});